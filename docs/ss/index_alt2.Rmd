---
title: "GMSP Indicators"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
---

```{r setup, include=FALSE}
#install.packages("ggplot2")
#install.packages("tidyverse")
#install.packages("plotly")
#install.packages("ggplotly")
library(flexdashboard)
library(ggplot2)
library(tidyverse)
library(plotly)
#library(ggplotly)


cca_data_p1 <- read.csv("C:/Users/Clayton.Adamson/GREATER MSP/Research & Intelligence - Documents/Major projects/Regional Indicators Dashboard/2023/cca_temp/cca_data_v1.csv") %>%
  select(-X, -NAESTIMATES, -RK2015, -RK2016, -RK2017, -RK2018, -RK2019, -RK2020,
         -RK2021, -RK2022, -RK2023) %>%
  gather(year, value, c(NA2015, NA2016, NA2017, NA2018, NA2019, NA2020, NA2021, 
                        NA2022, NA2023)) %>%
  mutate(year = substr(year,3,6))
cca_data_p2 <- read.csv("C:/Users/Clayton.Adamson/GREATER MSP/Research & Intelligence - Documents/Major projects/Regional Indicators Dashboard/2023/cca_temp/cca_data_v1.csv") %>%
  select(-X, -NAESTIMATES, -NA2015, -NA2016, -NA2017, -NA2018, -NA2019, -NA2020,
         -NA2021, -NA2022, -NA2023) %>%
  gather(year, rank, c(RK2015, RK2016, RK2017, RK2018, RK2019, RK2020, RK2021,
                       RK2022, RK2023)) %>%
  mutate(year = substr(year,3,6)) %>%
  select(MSA, year, code, rank)
cca_data = merge(x=cca_data_p1, y=cca_data_p2, by=c("MSA", "year", "code")) %>%
  mutate(year = as.numeric(year)) %>%
  rename("MSA_code"="MSA","MSA"="MSA_name")

#beginning year:
BY = 2017
EY = 2023
PY = 2021



```


# Gross Regional Product Growth {data-navmenu="Economy"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Gross Regional Product Growth",icon = NA,caption = "Indicator - Economy",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="E1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="E1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="E1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="E1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="E1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="E1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_E1 = cca_data %>% 
  filter(code=="E1") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.125), 
                     breaks = seq(0, 0.125, 0.025)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_E1, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_E1 = cca_data %>%
  filter(code=="E1") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.15), breaks = seq(0,0.15,0.025))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_E1, tooltip = c("MSA", "value"))
```


# Job Growth {data-navmenu="Economy"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Annual Job Growth",icon = NA,caption = "Indicator - Economy",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="E2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="E2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="E2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="E2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="E2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="E2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_E2 = cca_data %>% 
  filter(code=="E2") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.075), 
                     breaks = seq(0, 0.075, 0.025)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_E2, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_E2 = cca_data %>%
  filter(code=="E2") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.15), breaks = seq(0,0.15,0.025))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_E2, tooltip = c("MSA", "value"))
```

# Weekly Wage {data-navmenu="Economy"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Average Weekly Wage",icon = NA,caption = "Indicator - Economy",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="E3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="E3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="E3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="E3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="E3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="E3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_E3 = cca_data %>% 
  filter(code=="E3") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 2500), 
                     breaks = seq(0, 2500, 500)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_E3, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_E3 = cca_data %>%
  filter(code=="E3") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,2500), breaks = seq(0,2500,500))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_E3, tooltip = c("MSA", "value"))
```


# Jobs Paying Family Sustaining Wage {data-navmenu="Economy"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Jobs Paying a Family Sustaining Wage",icon = NA,caption = "Indicator - Economy",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="E4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="E4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="E4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="E4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="E4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="E4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_E4 = cca_data %>% 
  filter(code=="E4") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.10), 
                     breaks = seq(0, 0.70, 0.10)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_E4, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_E4 = cca_data %>%
  filter(code=="E4") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.70), breaks = seq(0,0.70,0.10))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_E4, tooltip = c("MSA", "value"))
```


# Wage Gap, White-BIPOC {data-navmenu="Economy"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Wage Gap, White-BIPOC",icon = NA,caption = "Indicator - Economy",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="E5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="E5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="E5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="E5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="E5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="E5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_E5 = cca_data %>% 
  filter(code=="E5") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.40), 
                     breaks = seq(0, 0.40, 0.10)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_E5, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_E5 = cca_data %>%
  filter(code=="E5") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.40), breaks = seq(0,0.40,0.10))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_E5, tooltip = c("MSA", "value"))
```


# Employment Gap, White-BIPOC {data-navmenu="Economy"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Employment Gap, White-BIPOC",icon = NA,caption = "Indicator - Economy",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="E6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="E6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="E5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="E6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="E6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="E6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_E6 = cca_data %>% 
  filter(code=="E6") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.025), 
                     breaks = seq(0, 0.125, 0.025)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_E6, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_E6 = cca_data %>%
  filter(code=="E6") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.125), breaks = seq(0,0.125,0.025))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_E6, tooltip = c("MSA", "value"))
```



# Venture Capital {data-navmenu="Business Vitality"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Annual Venture Capital (Billions)",icon = NA,caption = "Indicator - Business Vitality",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="BV1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="BV1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="BV1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="BV1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="BV1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="BV1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_BV1 = cca_data %>% 
  filter(code=="BV1") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 60), 
                     breaks = seq(0, 60, 10)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_BV1, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_BV1 = cca_data %>%
  filter(code=="BV1") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,60), breaks = seq(0,60,10))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_BV1, tooltip = c("MSA", "value"))
```



# Value of Exports {data-navmenu="Business Vitality"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Value of Exports (Billions)",icon = NA,caption = "Indicator - Business Vitality",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="BV2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="BV2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="BV2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="BV2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="BV2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="BV2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_BV2 = cca_data %>% 
  filter(code=="BV2") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 60), 
                     breaks = seq(0, 60, 10)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_BV2, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_BV2 = cca_data %>%
  filter(code=="BV2") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,60), breaks = seq(0,60,10))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_BV2, tooltip = c("MSA", "value"))
```


# Patents Per 1000 Workers {data-navmenu="Business Vitality"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Patents Issued per 1,000 Workers",icon = NA,caption = "Indicator - Business Vitality",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="BV3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="BV3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="BV3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="BV3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="BV3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="BV3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_BV3 = cca_data %>% 
  filter(code=="BV3") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 6), 
                     breaks = seq(0, 6, 1)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_BV3, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_BV3 = cca_data %>%
  filter(code=="BV3") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,6), breaks = seq(0,6,1))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_BV3, tooltip = c("MSA", "value"))
```

# Loans to Small Businesses {data-navmenu="Business Vitality"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Loans to Small Businesses (Millions)",icon = NA,caption = "Indicator - Business Vitality",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="BV4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="BV4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="BV4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="BV4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="BV4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="BV4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_BV4 = cca_data %>% 
  filter(code=="BV4") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 3000), 
                     breaks = seq(0, 3000, 500)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_BV4, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_BV4 = cca_data %>%
  filter(code=="BV4") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,3000), breaks = seq(0,3000,500))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_BV4, tooltip = c("MSA", "value"))
```


# New Establishments {data-navmenu="Business Vitality"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "New Establishments",icon = NA,caption = "Indicator - Business Vitality",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="BV5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="BV5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="BV5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="BV5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="BV5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="BV5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_BV5 = cca_data %>% 
  filter(code=="BV5") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 150000), 
                     breaks = seq(0, 150000, 25000)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_BV5, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_BV5 = cca_data %>%
  filter(code=="BV5") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,150000), breaks = seq(0,150000,25000))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_BV5, tooltip = c("MSA", "value"))
```


# 5-Year Business Survival {data-navmenu="Business Vitality"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Establishments Surviving After 5 Years",icon = NA,caption = "Indicator - Business Vitality",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="BV6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="BV6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="BV6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="BV6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="BV6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="BV6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_BV6 = cca_data %>% 
  filter(code=="BV6") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.6), 
                     breaks = seq(0, 0.6, 0.1)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_BV6, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_BV6 = cca_data %>%
  filter(code=="BV6") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.6), breaks = seq(0,0.6,0.1))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_BV6, tooltip = c("MSA", "value"))
```


# Net Migration of 25-34 Year Olds {data-navmenu="Talent"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Net Migration of 25-34 Year Olds",icon = NA,caption = "Indicator - Talent",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="T1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="T1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="T1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="T1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="T1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="T1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_T1 = cca_data %>% 
  filter(code=="T1") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(-15000, 20000), 
                     breaks = seq(-15000, 20000, 5000)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_T1, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_T1 = cca_data %>%
  filter(code=="T1") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(-15000,20000), breaks = seq(-15000,20000,5000))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_T1, tooltip = c("MSA", "value"))
```


# Growth in Tech Jobs {data-navmenu="Talent"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Annual Growth in Tech Jobs",icon = NA,caption = "Indicator - Talent",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="T2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="T2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="T2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="T2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="T2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="T2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_T2 = cca_data %>% 
  filter(code=="T2") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.125), 
                     breaks = seq(0, 0.125, 0.025)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_T2, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_T2 = cca_data %>%
  filter(code=="T2") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.125), breaks = seq(0,0.125,0.025))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_T2, tooltip = c("MSA", "value"))
```


# % of Females Working {data-navmenu="Talent"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Females Aged 16-64 Working",icon = NA,caption = "Indicator - Talent",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="T3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="T3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="T3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="T3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="T3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="T3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_T3 = cca_data %>% 
  filter(code=="T3") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.80), 
                     breaks = seq(0, 0.80, 0.20)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_T3, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_T3 = cca_data %>%
  filter(code=="T3") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.80), breaks = seq(0,0.80,0.20))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_T3, tooltip = c("MSA", "value"))
```


# % of Foreign-born Population Working {data-navmenu="Talent"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Foreign-born Aged 16-64 Working",icon = NA,caption = "Indicator - Talent",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="T4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="T4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="T4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="T4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="T4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="T4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_T4 = cca_data %>% 
  filter(code=="T4") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.80), 
                     breaks = seq(0, 0.80, 0.20)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_T4, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_T4 = cca_data %>%
  filter(code=="T4") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.80), breaks = seq(0,0.80,0.20))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_T4, tooltip = c("MSA", "value"))
```


# % with Associate's Degree {data-navmenu="Talent"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% of 25+ Population with Associate's Degree",icon = NA,caption = "Indicator - Talent",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="T5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="T5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="T5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="T5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="T5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="T5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_T5 = cca_data %>% 
  filter(code=="T5") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.60), 
                     breaks = seq(0, 0.60, 0.10)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_T5, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_T5 = cca_data %>%
  filter(code=="T5") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.60), breaks = seq(0,0.60,0.10))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_T5, tooltip = c("MSA", "value"))
```

# % with Bachelor's Degree {data-navmenu="Talent"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% of 25+ Population with Bachelor's Degree",icon = NA,caption = "Indicator - Talent",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="T6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="T6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="T6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="T6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="T6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="T6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_T6 = cca_data %>% 
  filter(code=="T6") %>%
  filter(MSA == "MSP") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.60), 
                     breaks = seq(0, 0.60, 0.10)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_T6, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_T6 = cca_data %>%
  filter(code=="T6") %>%
  filter(MSA == "MSP") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.60), breaks = seq(0,0.60,0.10))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_T6, tooltip = c("MSA", "value"))
```




# % Achieving Reading Standards, White {data-navmenu="Education"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% of White 3rd Graders Meeting Reading Standards",icon = NA,caption = "Indicator - Education",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="EDU1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="EDU1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="EDU1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="EDU1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="EDU1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="EDU1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
                   ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------
  
### Peer Comparison Over Time
  
```{r}
#LINE
cca1 = cca_data %>%
  filter(code == "EDU1") %>%
  filter(MSA == "MSP")
line1 = 
  ggplot(cca1, aes(x = year, y = value)) +
  geom_line(data=cca1[!is.na(cca1$value),],color='seagreen3',size=1.2) + 
  geom_point(color='seagreen3',size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.70), 
                     breaks = seq(0, 0.70, 0.10))

ggplotly(line1, tooltip = c("MSA", "value"))


```

### Peer Comparison - 2023

```{r}
#BAR
bar_EDU1 = cca_data %>%
  filter(code=="EDU1") %>%
  filter(MSA == "MSP") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.70), breaks = seq(0,0.70,0.10))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_EDU1, tooltip = c("MSA", "value"))
```



# Graduation Rate, 2-Year Institutions {data-navmenu="Education"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "3-Year Graduation Rate, 2-Year Institutions",icon = NA,caption = "Indicator - Education",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="EDU8") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="EDU8") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="EDU8") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="EDU8") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="EDU8") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="EDU8") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_EDU8 = cca_data %>% 
  filter(code=="EDU8") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.80), 
                     breaks = seq(0, 0.80, 0.20)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_EDU8, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_EDU8 = cca_data %>%
  filter(code=="EDU8") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.80), breaks = seq(0,0.80,0.20))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_EDU8, tooltip = c("MSA", "value"))
```


# Graduation Rate, 4-Year Institutions {data-navmenu="Education"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "6-Year Graduation Rate, 4-Year Institutions",icon = NA,caption = "Indicator - Education",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="EDU9") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="EDU9") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="EDU9") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="EDU9") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="EDU9") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="EDU9") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_EDU9 = cca_data %>% 
  filter(code=="EDU9") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.80), 
                     breaks = seq(0, 0.80, 0.20)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_EDU9, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_EDU9 = cca_data %>%
  filter(code=="EDU9") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.80), breaks = seq(0,0.80,0.20))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_EDU9, tooltip = c("MSA", "value"))
```



# Cost-burdened Households {data-navmenu="Livability"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% of Households that are Cost-Burdened",icon = NA,caption = "Indicator - Livability",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="L5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="L5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="L5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="L5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="L5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="L5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_L5 = cca_data %>% 
  filter(code=="L5") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.5), 
                     breaks = seq(0, 0.5, 0.1)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_L5, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_L5 = cca_data %>%
  filter(code=="L5") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.5), breaks = seq(0,0.5,0.1))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_L5, tooltip = c("MSA", "value"))
```


# Change in Median Rent {data-navmenu="Livability"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Change in Median Rent (2-BR Apt.)",icon = NA,caption = "Indicator - Livability",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="L6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="L6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="L6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="L6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="L6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="L6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_L6 = cca_data %>% 
  filter(code=="L6") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.10), 
                     breaks = seq(0, 0.10, 0.025)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_L6, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_L6 = cca_data %>%
  filter(code=="L6") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.15), breaks = seq(0,0.15,0.025))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_L6, tooltip = c("MSA", "value"))
```



# Gross Regional Product {data-navmenu="Vital Stats"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Gross Regional Product (Millions)",icon = NA,caption = "Indicator - Vital Statistics",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="V1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="V1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="V1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="V1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="V1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="V1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_V1 = cca_data %>% 
  filter(code=="V1") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 800000), 
                     breaks = seq(0, 800000, 200000)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_V1, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_V1 = cca_data %>%
  filter(code=="V1") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,800000), breaks = seq(0,800000,200000))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_V1, tooltip = c("MSA", "value"))
```


# Gross Regional Product per Capita {data-navmenu="Vital Stats"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Gross Regional Product per Capita",icon = NA,caption = "Indicator - Vital Statistics",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="V2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%  
  dplyr::mutate_if(is.numeric, round, 1) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="V2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="V2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="V2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="V2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="V2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_V2 = cca_data %>% 
  filter(code=="V2") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 150000), 
                     breaks = seq(0, 150000, 25000)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_V2, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_V2 = cca_data %>%
  filter(code=="V2") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,150000), breaks = seq(0,150000,25000))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_V2, tooltip = c("MSA", "value"))
```


