---
title: "2023 GMSP Indicators"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
---

```{r setup, include=FALSE}
#install.packages("ggplot2")
#install.packages("tidyverse")
#install.packages("plotly")
#install.packages("ggplotly")
library(flexdashboard)
library(ggplot2)
library(tidyverse)
library(plotly)
#library(ggplotly)


cca_data_p1 <- read.csv("G:/My Drive/Research/GMSP/cca_temp/cca_data_v1.csv") %>%
  select(-X, -NAESTIMATES, -RK2015, -RK2016, -RK2017, -RK2018, -RK2019, -RK2020,
         -RK2021, -RK2022, -RK2023) %>%
  gather(year, value, c(NA2015, NA2016, NA2017, NA2018, NA2019, NA2020, NA2021, 
                        NA2022, NA2023)) %>%
  mutate(year = substr(year,3,6))
cca_data_p2 <- read.csv("G:/My Drive/Research/GMSP/cca_temp/cca_data_v1.csv") %>%
  select(-X, -NAESTIMATES, -NA2015, -NA2016, -NA2017, -NA2018, -NA2019, -NA2020,
         -NA2021, -NA2022, -NA2023) %>%
  gather(year, rank, c(RK2015, RK2016, RK2017, RK2018, RK2019, RK2020, RK2021,
                       RK2022, RK2023)) %>%
  mutate(year = substr(year,3,6)) %>%
  select(MSA, year, code, rank)
cca_data = merge(x=cca_data_p1, y=cca_data_p2, by=c("MSA", "year", "code")) %>%
  mutate(year = as.numeric(year)) %>%
  rename("MSA_code"="MSA","MSA"="MSA_name")

#beginning year:
BY = 2017
EY = 2023
PY = 2021



```


# Gross Regional Product Growth {data-navmenu="Economy"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Gross Regional Product Growth",icon = NA,caption = "Indicator - Economy",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="E1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="E1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="E1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="E1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="E1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="E1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_E1 = cca_data %>% 
  filter(code=="E1") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.11), 
                     breaks = seq(0, 0.11, 0.025)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_E1, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_E1 = cca_data %>%
  filter(code=="E1") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.11), breaks = seq(0,0.11,0.025))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_E1, tooltip = c("MSA", "value"))
```


# Job Growth {data-navmenu="Economy"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Annual Job Growth",icon = NA,caption = "Indicator - Economy",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="E2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="E2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="E2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="E2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="E2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="E2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_E2 = cca_data %>% 
  filter(code=="E2") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.075), 
                     breaks = seq(0, 0.075, 0.01)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_E2, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_E2 = cca_data %>%
  filter(code=="E2") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.075), breaks = seq(0,0.075,0.01))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_E2, tooltip = c("MSA", "value"))
```

# Weekly Wage {data-navmenu="Economy"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Average Weekly Wage",icon = NA,caption = "Indicator - Economy",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="E3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="E3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="E3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="E3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="E3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="E3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_E3 = cca_data %>% 
  filter(code=="E3") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 2500), 
                     breaks = seq(0, 2500, 500)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_E3, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_E3 = cca_data %>%
  filter(code=="E3") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,2500), breaks = seq(0,2500,500))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_E3, tooltip = c("MSA", "value"))
```


# Jobs Paying Family Sustaining Wage {data-navmenu="Economy"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Jobs Paying a Family Sustaining Wage",icon = NA,caption = "Indicator - Economy",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="E4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="E4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="E4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="E4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="E4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="E4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_E4 = cca_data %>% 
  filter(code=="E4") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 1.0), 
                     breaks = seq(0, 1.0, 0.20)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_E4, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_E4 = cca_data %>%
  filter(code=="E4") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,1.0), breaks = seq(0,1.0,0.20))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_E4, tooltip = c("MSA", "value"))
```


# Wage Gap, White-BIPOC {data-navmenu="Economy"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Wage Gap, White-BIPOC",icon = NA,caption = "Indicator - Economy",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="E5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="E5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="E5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Worsening",
              ifelse(box3b<box3a,"Improving","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-down",
                   ifelse(box3 == "Worsening","fa-arrow-up","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="E5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="E5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="E5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_E5 = cca_data %>% 
  filter(code=="E5") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.50), 
                     breaks = seq(0, 0.50, 0.10)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_E5, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_E5 = cca_data %>%
  filter(code=="E5") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.50), breaks = seq(0,0.50,0.10))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_E5, tooltip = c("MSA", "value"))
```


# Employment Gap, White-BIPOC {data-navmenu="Economy"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Employment Gap, White-BIPOC",icon = NA,caption = "Indicator - Economy",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="E6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="E6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="E5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-down",
                   ifelse(box3 == "Worsening","fa-arrow-up","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="E6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="E6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="E6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_E6 = cca_data %>% 
  filter(code=="E6") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.13), 
                     breaks = seq(0, 0.13, 0.025)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_E6, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_E6 = cca_data %>%
  filter(code=="E6") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.125), breaks = seq(0,0.125,0.025))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_E6, tooltip = c("MSA", "value"))
```



# Venture Capital {data-navmenu="Business Vitality"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Annual Venture Capital (Billions)",icon = NA,caption = "Indicator - Business Vitality",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="BV1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="BV1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="BV1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="BV1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="BV1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="BV1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_BV1 = cca_data %>% 
  filter(code=="BV1") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 65), 
                     breaks = seq(0, 65, 10)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_BV1, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_BV1 = cca_data %>%
  filter(code=="BV1") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,60), breaks = seq(0,60,10))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_BV1, tooltip = c("MSA", "value"))
```



# Value of Exports {data-navmenu="Business Vitality"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Value of Exports (Billions)",icon = NA,caption = "Indicator - Business Vitality",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="BV2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="BV2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="BV2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="BV2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="BV2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="BV2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_BV2 = cca_data %>% 
  filter(code=="BV2") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 70), 
                     breaks = seq(0, 70, 10)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_BV2, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_BV2 = cca_data %>%
  filter(code=="BV2") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,70), breaks = seq(0,70,10))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_BV2, tooltip = c("MSA", "value"))
```


# Patents Per 1000 Workers {data-navmenu="Business Vitality"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Patents Issued per 1,000 Workers",icon = NA,caption = "Indicator - Business Vitality",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="BV3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 2) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="BV3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="BV3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="BV3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="BV3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="BV3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_BV3 = cca_data %>% 
  filter(code=="BV3") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 26), 
                     breaks = seq(0, 26, 5)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_BV3, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_BV3 = cca_data %>%
  filter(code=="BV3") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,25), breaks = seq(0,25,5))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_BV3, tooltip = c("MSA", "value"))
```

# Loans to Small Businesses {data-navmenu="Business Vitality"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Loans to Small Businesses (Millions)",icon = NA,caption = "Indicator - Business Vitality",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="BV4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="BV4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="BV4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="BV4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="BV4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="BV4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_BV4 = cca_data %>% 
  filter(code=="BV4") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 4000), 
                     breaks = seq(0, 4000, 1000)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_BV4, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_BV4 = cca_data %>%
  filter(code=="BV4") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,4000), breaks = seq(0,4000,1000))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_BV4, tooltip = c("MSA", "value"))
```


# New Establishments {data-navmenu="Business Vitality"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "New Establishments",icon = NA,caption = "Indicator - Business Vitality",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="BV5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="BV5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="BV5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="BV5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="BV5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="BV5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_BV5 = cca_data %>% 
  filter(code=="BV5") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 175000), 
                     breaks = seq(0, 175000, 25000)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_BV5, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_BV5 = cca_data %>%
  filter(code=="BV5") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,175000), breaks = seq(0,175000,25000))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_BV5, tooltip = c("MSA", "value"))
```


# 5-Year Business Survival {data-navmenu="Business Vitality"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Establishments Surviving After 5 Years",icon = NA,caption = "Indicator - Business Vitality",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="BV6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="BV6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="BV6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="BV6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="BV6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="BV6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_BV6 = cca_data %>% 
  filter(code=="BV6") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.65), 
                     breaks = seq(0, 0.65, 0.1)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_BV6, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_BV6 = cca_data %>%
  filter(code=="BV6") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.65), breaks = seq(0,0.65,0.1))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_BV6, tooltip = c("MSA", "value"))
```


# Net Migration of 25-34 Year Olds {data-navmenu="Talent"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Net Migration of 25-34 Year Olds",icon = NA,caption = "Indicator - Talent",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="T1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="T1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="T1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="T1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="T1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="T1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_T1 = cca_data %>% 
  filter(code=="T1") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  geom_hline(yintercept = 0) +
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(-25000, 25000), 
                     breaks = seq(-25000, 25000, 5000)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_T1, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_T1 = cca_data %>%
  filter(code=="T1") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(-20000,20000), breaks = seq(-20000,20000,5000))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_T1, tooltip = c("MSA", "value"))
```


# Growth in Tech Jobs {data-navmenu="Talent"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Annual Growth in Tech Jobs",icon = NA,caption = "Indicator - Talent",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="T2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="T2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="T2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="T2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="T2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="T2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_T2 = cca_data %>% 
  filter(code=="T2") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_hline(yintercept = 0) +
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(-0.05, 0.125), 
                     breaks = seq(-0.05, 0.125, 0.025)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_T2, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_T2 = cca_data %>%
  filter(code=="T2") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.125), breaks = seq(0,0.125,0.025))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_T2, tooltip = c("MSA", "value"))
```


# % of Females Working {data-navmenu="Talent"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Females Aged 16-64 Working",icon = NA,caption = "Indicator - Talent",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="T3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="T3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="T3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="T3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="T3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="T3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_T3 = cca_data %>% 
  filter(code=="T3") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 1.00), 
                     breaks = seq(0, 1.00, 0.20)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_T3, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_T3 = cca_data %>%
  filter(code=="T3") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,1.00), breaks = seq(0,1.00,0.20))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_T3, tooltip = c("MSA", "value"))
```


# % of Foreign-born Population Working {data-navmenu="Talent"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Foreign-born Aged 16-64 Working",icon = NA,caption = "Indicator - Talent",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="T4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="T4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="T4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="T4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="T4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="T4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_T4 = cca_data %>% 
  filter(code=="T4") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 1.00), 
                     breaks = seq(0, 1.00, 0.20)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_T4, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_T4 = cca_data %>%
  filter(code=="T4") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,1.00), breaks = seq(0,1.00,0.20))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_T4, tooltip = c("MSA", "value"))
```


# % with Associate's Degree {data-navmenu="Talent"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% of 25+ Population with Associate's Degree",icon = NA,caption = "Indicator - Talent",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="T5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="T5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="T5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="T5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="T5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="T5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_T5 = cca_data %>% 
  filter(code=="T5") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.60), 
                     breaks = seq(0, 0.60, 0.10)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_T5, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_T5 = cca_data %>%
  filter(code=="T5") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.60), breaks = seq(0,0.60,0.10))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_T5, tooltip = c("MSA", "value"))
```

# % with Bachelor's Degree {data-navmenu="Talent"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% of 25+ Population with Bachelor's Degree",icon = NA,caption = "Indicator - Talent",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="T6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="T6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="T6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="T6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="T6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="T6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_T6 = cca_data %>% 
  filter(code=="T6") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.60), 
                     breaks = seq(0, 0.60, 0.10)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_T6, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_T6 = cca_data %>%
  filter(code=="T6") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.60), breaks = seq(0,0.60,0.10))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_T6, tooltip = c("MSA", "value"))
```




# % Achieving Reading Standards, White {data-navmenu="Education"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% of White 3rd Graders Meeting Reading Standards",icon = NA,caption = "Indicator - Education",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="EDU1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="EDU1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="EDU1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="EDU1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="EDU1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="EDU1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
                   ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------
  
### Peer Comparison Over Time
  
```{r}
#LINE
cca1 = cca_data %>%
  filter(code == "EDU1") %>%
  filter(MSA == "MSP")
line1 = 
  ggplot(cca1, aes(x = year, y = value)) +
  geom_line(data=cca1[!is.na(cca1$value),],color='seagreen3',size=1.2) + 
  geom_point(color='seagreen3',size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.70), 
                     breaks = seq(0, 0.70, 0.10))

ggplotly(line1, tooltip = c("MSA", "value"))


```

### Peer Comparison - 2023

```{r}
#BAR
bar_EDU1 = cca_data %>%
  filter(code=="EDU1") %>%
  filter(MSA == "MSP") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.70), breaks = seq(0,0.70,0.10))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_EDU1, tooltip = c("MSA", "value"))
```

# % Achieving Reading Standards, BIPOC {data-navmenu="Education"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% of BIPOC 3rd Graders Meeting Reading Standards",icon = NA,caption = "Indicator - Education",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="EDU2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="EDU2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="EDU2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="EDU2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="EDU2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="EDU2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
                   ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------
  
### Peer Comparison Over Time
  
```{r}
#LINE
cca1 = cca_data %>%
  filter(code == "EDU2") %>%
  filter(MSA == "MSP")
line1 = 
  ggplot(cca1, aes(x = year, y = value)) +
  geom_line(data=cca1[!is.na(cca1$value),],color='seagreen3',size=1.2) + 
  geom_point(color='seagreen3',size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.70), 
                     breaks = seq(0, 0.70, 0.10))

ggplotly(line1, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_EDU2 = cca_data %>%
  filter(code=="EDU2") %>%
  filter(MSA == "MSP") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.70), breaks = seq(0,0.70,0.10))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_EDU2, tooltip = c("MSA", "value"))
```


# % Achieving Math Standards, White {data-navmenu="Education"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% of White 8th Graders Meeting Math Standards",icon = NA,caption = "Indicator - Education",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="EDU3") %>%
  filter(MSA == "MSP") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="EDU3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="EDU3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="EDU3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="EDU3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="EDU3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
                   ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------
  
### Peer Comparison Over Time
  
```{r}
#LINE
cca1 = cca_data %>%
  filter(code == "EDU3") %>%
  filter(MSA == "MSP")
line1 = 
  ggplot(cca1, aes(x = year, y = value)) +
  geom_line(data=cca1[!is.na(cca1$value),],color='seagreen3',size=1.2) + 
  geom_point(color='seagreen3',size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.75), 
                     breaks = seq(0, 0.75, 0.10))

ggplotly(line1, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_EDU3 = cca_data %>%
  filter(code=="EDU3") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.75), breaks = seq(0,0.75,0.10))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_EDU3, tooltip = c("MSA", "value"))
```


# % Achieving Math Standards, BIPOC {data-navmenu="Education"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% of BIPOC 8th Graders Meeting Math Standards",icon = NA,caption = "Indicator - Education",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="EDU4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="EDU4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="EDU4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="EDU4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="EDU4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="EDU4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
                   ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------
  
### Peer Comparison Over Time
  
```{r}
#LINE
cca1 = cca_data %>%
  filter(code == "EDU4") %>%
  filter(MSA == "MSP")
line1 = 
  ggplot(cca1, aes(x = year, y = value)) +
  geom_line(data=cca1[!is.na(cca1$value),],color='seagreen3',size=1.2) + 
  geom_point(color='seagreen3',size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.75), 
                     breaks = seq(0, 0.75, 0.10))

ggplotly(line1, tooltip = c("MSA", "value"))


```

### Peer Comparison - 2023

```{r}
#BAR
bar_EDU4 = cca_data %>%
  filter(code=="EDU4") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.75), breaks = seq(0,0.75,0.10))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_EDU4, tooltip = c("MSA", "value"))
```



# H.S. Graduation Rate, White {data-navmenu="Education"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "High School Graduation Rate, White",icon = NA,caption = "Indicator - Education",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="EDU5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="EDU5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="EDU5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="EDU5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="EDU5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="EDU5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
                   ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------
  
### Peer Comparison Over Time
  
```{r}
#LINE
cca1 = cca_data %>%
  filter(code == "EDU5") %>%
  filter(MSA == "MSP")
line1 = 
  ggplot(cca1, aes(x = year, y = value)) +
  geom_line(data=cca1[!is.na(cca1$value),],color='seagreen3',size=1.2) + 
  geom_point(color='seagreen3',size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 1.00), 
                     breaks = seq(0, 1.00, 0.20))

ggplotly(line1, tooltip = c("MSA", "value"))


```

### Peer Comparison - 2023

```{r}
#BAR
bar_EDU5 = cca_data %>%
  filter(code=="EDU5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,1.00), breaks = seq(0,1.00,0.20))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_EDU5, tooltip = c("MSA", "value"))
```


# H.S. Graduation Rate, BIPOC {data-navmenu="Education"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "High School Graduation Rate, BIPOC",icon = NA,caption = "Indicator - Education",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="EDU6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="EDU6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="EDU6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="EDU6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="EDU6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="EDU6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
                   ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------
  
### Peer Comparison Over Time
  
```{r}
#LINE
cca1 = cca_data %>%
  filter(code == "EDU6") %>%
  filter(MSA == "MSP")
line1 = 
  ggplot(cca1, aes(x = year, y = value)) +
  geom_line(data=cca1[!is.na(cca1$value),],color='seagreen3',size=1.2) + 
  geom_point(color='seagreen3',size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 1.00), 
                     breaks = seq(0, 1.00, 0.20))

ggplotly(line1, tooltip = c("MSA", "value"))


```

### Peer Comparison - 2023

```{r}
#BAR
bar_EDU6 = cca_data %>%
  filter(MSA == "MSP") %>%
  filter(code=="EDU6") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,1.00), breaks = seq(0,1.00,0.20))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_EDU6, tooltip = c("MSA", "value"))
```


# Post-secondary Enrollees {data-navmenu="Education"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "H.S. Grads Enrolling Post-Secondary",icon = NA,caption = "Indicator - Education",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="EDU7") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="EDU7") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="EDU7") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="EDU7") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="EDU7") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="EDU7") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
                   ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------
  
### Peer Comparison Over Time
  
```{r}
#LINE
cca1 = cca_data %>%
  filter(code == "EDU7") %>%
  filter(MSA == "MSP")
line1 = 
  ggplot(cca1, aes(x = year, y = value)) +
  geom_line(data=cca1[!is.na(cca1$value),],color='seagreen3',size=1.2) + 
  geom_point(color='seagreen3',size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 1.00), 
                     breaks = seq(0, 1.00, 0.20))

ggplotly(line1, tooltip = c("MSA", "value"))


```

### Peer Comparison - 2023

```{r}
#BAR
bar_EDU7 = cca_data %>%
  filter(code=="EDU7") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,1.00), breaks = seq(0,1.00,0.20))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_EDU7, tooltip = c("MSA", "value"))
```


# Graduation Rate, 2-Year Institutions {data-navmenu="Education"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "3-Year Graduation Rate, 2-Year Institutions",icon = NA,caption = "Indicator - Education",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="EDU8") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="EDU8") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="EDU8") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="EDU8") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="EDU8") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="EDU8") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_EDU8 = cca_data %>% 
  filter(code=="EDU8") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.80), 
                     breaks = seq(0, 0.80, 0.20)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_EDU8, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_EDU8 = cca_data %>%
  filter(code=="EDU8") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.80), breaks = seq(0,0.80,0.20))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_EDU8, tooltip = c("MSA", "value"))
```


# Graduation Rate, 4-Year Institutions {data-navmenu="Education"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "6-Year Graduation Rate, 4-Year Institutions",icon = NA,caption = "Indicator - Education",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="EDU9") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="EDU9") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="EDU9") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="EDU9") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="EDU9") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="EDU9") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_EDU9 = cca_data %>% 
  filter(code=="EDU9") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.80), 
                     breaks = seq(0, 0.80, 0.20)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_EDU9, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_EDU9 = cca_data %>%
  filter(code=="EDU9") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.80), breaks = seq(0,0.80,0.20))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_EDU9, tooltip = c("MSA", "value"))
```


# Access to Broadband of 1 GB {data-navmenu="Infrastructure"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% with Access to Broadband Speeds of 1 GB",icon = NA,caption = "Indicator - Infrastructure",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="I1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="I1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="I1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="I1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="I1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="I1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
                   ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------
  
### Peer Comparison Over Time
  
```{r}
#LINE
line_I1 = cca_data %>% 
  filter(code=="I1") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.8), 
                     breaks = seq(0, 0.8, 0.1)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_I1, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_I1 = cca_data %>%
  filter(code=="I1") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.8), breaks = seq(0,0.8,0.1))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_I1, tooltip = c("MSA", "value"))
```


# Direct Routes from Airport {data-navmenu="Infrastructure"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Number of Direct Routes from Airport",icon = NA,caption = "Indicator - Infrastructure",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="I2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="I2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="I2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="I2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="I2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="I2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_I2 = cca_data %>% 
  filter(code=="I2") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 275), 
                     breaks = seq(0, 275, 50)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_I2, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_I2 = cca_data %>%
  filter(code=="I2") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,275), breaks = seq(0,275,50))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_I2, tooltip = c("MSA", "value"))
```


# Highway Miles in Good Condition {data-navmenu="Infrastructure"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% of Highway Miles in Good Condition",icon = NA,caption = "Indicator - Infrastructure",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="I3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="I3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="I3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="I3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="I3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="I3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
cca1 = cca_data %>%
  filter(code == "I3") %>%
  filter(MSA == "MSP")
line1 = 
  ggplot(cca1, aes(x = year, y = value)) +
  geom_line(data=cca1[!is.na(cca1$value),],color='seagreen3',size=1.2) + 
  geom_point(color='seagreen3',size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 1.00), 
                     breaks = seq(0, 1.00, 0.20))

ggplotly(line1, tooltip = c("MSA", "value"))


```

### Peer Comparison - 2023

```{r}
#BAR
bar_I3 = cca_data %>%
  filter(code=="I3") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.8), breaks = seq(0,0.8,0.2))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_I3, tooltip = c("MSA", "value"))
```


# Bridges in Poor Condition {data-navmenu="Infrastructure"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% of Bridges in Poor Condition",icon = NA,caption = "Indicator - Infrastructure",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="I4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="I4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="I4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Worsening",
              ifelse(box3b<box3a,"Improving","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-down",
                   ifelse(box3 == "Worsening","fa-arrow-up","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="I4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="I4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="I4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-down",
              ifelse(box4b>box4a,"fa-arrow-up","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_I4 = cca_data %>% 
  filter(code=="I4") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.2), 
                     breaks = seq(0, 0.2, 0.05)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_I4, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_I4 = cca_data %>%
  filter(code=="I4") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.2), breaks = seq(0,0.2,0.05))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_I4, tooltip = c("MSA", "value"))
```



# Hours of Delay Per Commuter {data-navmenu="Infrastructure"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Annual Hours of Delay Per Commuter",icon = NA,caption = "Indicator - Infrastructure",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="I5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="I5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="I5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="I5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="I5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="I5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_I5 = cca_data %>% 
  filter(code=="I5") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 105), 
                     breaks = seq(0, 105, 20)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_I5, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_I5 = cca_data %>%
  filter(code=="I5") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,105), breaks = seq(0,105,20))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_I5, tooltip = c("MSA", "value"))
```


# % Within 30 Minutes of 100,000 Jobs {data-navmenu="Infrastructure"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% Within 30 Minutes of 100,000 Jobs by Transit",icon = NA,caption = "Indicator - Infrastructure",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="I6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="I6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="I6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="I6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="I6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="I6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_I6 = cca_data %>% 
  filter(code=="I6") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.2), 
                     breaks = seq(0, 0.2, 0.05)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_I6, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_I6 = cca_data %>%
  filter(code=="I6") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.2), breaks = seq(0,0.2,0.05))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_I6, tooltip = c("MSA", "value"))
```


# % Commutes Less than 30 Minutes {data-navmenu="Infrastructure"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% with Commutes Less than 30 Minutes",icon = NA,caption = "Indicator - Infrastructure",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="I7") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="I7") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="I7") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="I7") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="I7") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="I7") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_I7 = cca_data %>% 
  filter(code=="I7") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.70), 
                     breaks = seq(0, 0.70, 0.10)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_I7, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_I7 = cca_data %>%
  filter(code=="I7") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.70), breaks = seq(0,0.70,0.10))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_I7, tooltip = c("MSA", "value"))
```


# EV Charging Stations {data-navmenu="Environment"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "EV Charging Stations per 100K Residents",icon = NA,caption = "Indicator - Environment",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="ENV1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="ENV1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="ENV1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="ENV1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="ENV1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="ENV1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_ENV1 = cca_data %>% 
  filter(code=="ENV1") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 150), 
                     breaks = seq(0, 150, 25)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_ENV1, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_ENV1 = cca_data %>%
  filter(code=="ENV1") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,150), breaks = seq(0,150,25))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_ENV1, tooltip = c("MSA", "value"))
```


# % Within 10 Minutes Walk of Park {data-navmenu="Environment"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% Within 10 Minutes Walk of Park",icon = NA,caption = "Indicator - Environment",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="ENV2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="ENV2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="ENV2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="ENV2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="ENV2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="ENV2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_ENV2 = cca_data %>% 
  filter(code=="ENV2") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 1.00), 
                     breaks = seq(0, 1.00, 0.20)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_ENV2, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_ENV2 = cca_data %>%
  filter(code=="ENV2") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,1.00), breaks = seq(0,1.00,0.20))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_ENV2, tooltip = c("MSA", "value"))
```



# Days with Poor Air Quality {data-navmenu="Environment"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Days with Poor Air Quality",icon = NA,caption = "Indicator - Environment",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="ENV3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="ENV3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="ENV3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Worsening",
              ifelse(box3b<box3a,"Improving","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-down",
                   ifelse(box3 == "Worsening","fa-arrow-up","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="ENV3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="ENV3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="ENV3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_ENV3 = cca_data %>% 
  filter(code=="ENV3") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 60), 
                     breaks = seq(0, 60, 10)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_ENV3, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_ENV3 = cca_data %>%
  filter(code=="ENV3") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,60), breaks = seq(0,60,10))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_ENV3, tooltip = c("MSA", "value"))
```


# Energy-related CO2 Emissions {data-navmenu="Environment"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Energy-related CO2 Emissions per Capita (Metric Tons)",icon = NA,caption = "Indicator - Environment",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="ENV4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="ENV4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="ENV4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Worsening",
              ifelse(box3b<box3a,"Improving","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-down",
                   ifelse(box3 == "Worsening","fa-arrow-up","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="ENV4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="ENV4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="ENV4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-down",
              ifelse(box4b>box4a,"fa-arrow-up","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_ENV4 = cca_data %>% 
  filter(code=="ENV4") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 30), 
                     breaks = seq(0, 30, 5)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_ENV4, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_ENV4 = cca_data %>%
  filter(code=="ENV4") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,30), breaks = seq(0,30,5))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_ENV4, tooltip = c("MSA", "value"))
```


# Electricity Costs {data-navmenu="Environment"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Electricity Costs (Cents/kWh)",icon = NA,caption = "Indicator - Environment",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="ENV5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="ENV5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="ENV5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Worsening",
              ifelse(box3b<box3a,"Improving","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-down",
                   ifelse(box3 == "Worsening","fa-arrow-up","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="ENV5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="ENV5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="ENV5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-down",
              ifelse(box4b>box4a,"fa-arrow-up","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_ENV5 = cca_data %>% 
  filter(code=="ENV5") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 25), 
                     breaks = seq(0, 25, 5)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_ENV5, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_ENV5 = cca_data %>%
  filter(code=="ENV5") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,25), breaks = seq(0,25,5))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_ENV5, tooltip = c("MSA", "value"))
```


# Electricity from Non-carbon Sources {data-navmenu="Environment"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% of Electricity from Non-carbon Sources",icon = NA,caption = "Indicator - Environment",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="ENV6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="ENV6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="ENV6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="ENV6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="ENV6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="ENV6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_ENV6 = cca_data %>% 
  filter(code=="ENV6") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 1.00), 
                     breaks = seq(0, 1.00, 0.20)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_ENV6, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_ENV6 = cca_data %>%
  filter(code=="ENV6") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,1.00), breaks = seq(0,1.00,0.20))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_ENV6, tooltip = c("MSA", "value"))
```


# Population that is Obese {data-navmenu="Livability"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% of Population that is Obese",icon = NA,caption = "Indicator - Livability",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="L1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="L1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="L1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Worsening",
              ifelse(box3b<box3a,"Improving","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-down",
                   ifelse(box3 == "Worsening","fa-arrow-up","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="L1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="L1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="L1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-down",
              ifelse(box4b>box4a,"fa-arrow-up","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_L1 = cca_data %>% 
  filter(code=="L1") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.4), 
                     breaks = seq(0, 0.4, 0.1)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_L1, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_L1 = cca_data %>%
  filter(code=="L1") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.4), breaks = seq(0,0.4,0.1))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_L1, tooltip = c("MSA", "value"))
```


# Violent Crimes Per 100K Residents {data-navmenu="Livability"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Violent Crimes Per 100K Residents",icon = NA,caption = "Indicator - Livability",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="L2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="L2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="L2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Worsening",
              ifelse(box3b<box3a,"Improving","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-down",
                   ifelse(box3 == "Worsening","fa-arrow-up","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="L2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="L2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="L2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
cca1 = cca_data %>%
  filter(code == "L2") %>%
  filter(MSA == "MSP")
line1 = 
  ggplot(cca1, aes(x = year, y = value)) +
  geom_line(data=cca1[!is.na(cca1$value),],color='seagreen3',size=1.2) + 
  geom_point(color='seagreen3',size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 500), 
                     breaks = seq(0, 500, 100))

ggplotly(line1, tooltip = c("MSA", "value"))


```

### Peer Comparison - 2023

```{r}
#BAR
bar_L2 = cca_data %>%
  filter(code=="L2") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,500), breaks = seq(0,500,100))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_L2, tooltip = c("MSA", "value"))
```



# % Volunteer in Past Year {data-navmenu="Livability"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% Volunteering in Past Year",icon = NA,caption = "Indicator - Livability",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="L3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="L3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="L3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="L3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="L3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="L3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_L3 = cca_data %>% 
  filter(code=="L3") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.5), 
                     breaks = seq(0, 0.5, 0.1)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_L3, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_L3 = cca_data %>%
  filter(code=="L3") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.5), breaks = seq(0,0.5,0.1))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_L3, tooltip = c("MSA", "value"))
```


# Median Home Purchase Price {data-navmenu="Livability"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Median Home Purchase Price",icon = NA,caption = "Indicator - Livability",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="L4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="L4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="L4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Worsening",
              ifelse(box3b<box3a,"Improving","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-down",
                   ifelse(box3 == "Worsening","fa-arrow-up","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="L4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="L4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="L4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_L4 = cca_data %>% 
  filter(code=="L4") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 1400000), 
                     breaks = seq(0, 1400000, 200000)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_L4, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_L4 = cca_data %>%
  filter(code=="L4") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,1400000), breaks = seq(0,1400000,200000))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_L4, tooltip = c("MSA", "value"))
```


# Cost-burdened Households {data-navmenu="Livability"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "% of Households that are Cost-Burdened",icon = NA,caption = "Indicator - Livability",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="L5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="L5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="L5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Worsening",
              ifelse(box3b<box3a,"Improving","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-down",
                   ifelse(box3 == "Worsening","fa-arrow-up","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="L5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="L5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="L5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_L5 = cca_data %>% 
  filter(code=="L5") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.5), 
                     breaks = seq(0, 0.5, 0.1)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_L5, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_L5 = cca_data %>%
  filter(code=="L5") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.5), breaks = seq(0,0.5,0.1))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_L5, tooltip = c("MSA", "value"))
```


# Change in Median Rent {data-navmenu="Livability"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Change in Median Rent (2-BR Apt.)",icon = NA,caption = "Indicator - Livability",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="L6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="L6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="L6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Worsening",
              ifelse(box3b<box3a,"Improving","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-down",
                   ifelse(box3 == "Worsening","fa-arrow-up","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="L6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="L6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="L6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_L6 = cca_data %>% 
  filter(code=="L6") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.10), 
                     breaks = seq(0, 0.10, 0.02)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_L6, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_L6 = cca_data %>%
  filter(code=="L6") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.10), breaks = seq(0,0.10,0.02))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_L6, tooltip = c("MSA", "value"))
```


# Gross Regional Product {data-navmenu="Vital Stats"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Gross Regional Product (Millions)",icon = NA,caption = "Indicator - Vital Statistics",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="V1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  dplyr::mutate_if(is.numeric, round, 1) %>%
  format(big.mark = ",", scientific = FALSE) %>%
  pull(value)

valueBox(value = box2, icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="V1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="V1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="V1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="V1") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="V1") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}

#LINE
line_V1 = cca_data %>% 
  filter(code=="V1") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(labels = scales::comma, expand = c(0, 0), limits = c(0, 800000), 
                     breaks = seq(0, 800000, 200000)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_V1, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_V1 = cca_data %>%
  filter(code=="V1") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,800000), breaks = seq(0,800000,200000))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_V1, tooltip = c("MSA", "value"))
```


# Gross Regional Product per Capita {data-navmenu="Vital Stats"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Gross Regional Product per Capita",icon = NA,caption = "Indicator - Vital Statistics",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="V2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%  
  dplyr::mutate_if(is.numeric, round, 1) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="V2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="V2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="V2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="V2") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="V2") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_V2 = cca_data %>% 
  filter(code=="V2") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 150000), 
                     breaks = seq(0, 150000, 25000)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_V2, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_V2 = cca_data %>%
  filter(code=="V2") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,150000), breaks = seq(0,150000,25000))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_V2, tooltip = c("MSA", "value"))
```


# Median Household Income {data-navmenu="Vital Stats"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Median Household Income",icon = NA,caption = "Indicator - Vital Statistics",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="V3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%  
  dplyr::mutate_if(is.numeric, round, 1) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="V3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="V3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="V3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="V3") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="V3") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_V3 = cca_data %>% 
  filter(code=="V3") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 150000), 
                     breaks = seq(0, 150000, 25000)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_V3, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_V3 = cca_data %>%
  filter(code=="V3") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,150000), breaks = seq(0,150000,25000))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_V3, tooltip = c("MSA", "value"))
```


# Labor Force Participation Rate {data-navmenu="Vital Stats"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Labor Force Participation Rate",icon = NA,caption = "Indicator - Vital Statistics",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="V4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="V4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="V4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="V4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="V4") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="V4") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
                   ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------
  
### Peer Comparison Over Time
  
```{r}
#LINE
line_V4 = cca_data %>% 
  filter(code=="V4") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.8), 
                     breaks = seq(0, 0.8, 0.2)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_V4, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_V4 = cca_data %>%
  filter(code=="V4") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.8), breaks = seq(0,0.8,0.2))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_V4, tooltip = c("MSA", "value"))
```


# Total Jobs {data-navmenu="Vital Stats"}


Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Total Jobs",icon = NA,caption = "Indicator - Vital Statistics",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="V5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%  
  dplyr::mutate_if(is.numeric, round, 1) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="V5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="V5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="V5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="V5") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="V5") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_V5 = cca_data %>% 
  filter(code=="V5") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 5000000), 
                     breaks = seq(0, 1000000, 5000000)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_V5, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_V5 = cca_data %>%
  filter(code=="V5") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,5000000), breaks = seq(0,5000000,1000000))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_V5, tooltip = c("MSA", "value"))
```


# Unemployment Rate {data-navmenu="Vital Stats"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Annualized Unemployment Rate",icon = NA,caption = "Indicator - Vital Statistics",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="V6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="V6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="V6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="V6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="V6") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="V6") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
                   ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------
  
### Peer Comparison Over Time
  
```{r}
#LINE
line_V6 = cca_data %>% 
  filter(code=="V6") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.1), 
                     breaks = seq(0, 0.1, 0.02)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_V6, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_V6 = cca_data %>%
  filter(code=="V6") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.1), breaks = seq(0,0.1,0.02))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_V6, tooltip = c("MSA", "value"))
```


# Corporate Tax Rate {data-navmenu="Vital Stats"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Top-tier Corporate Tax Rate",icon = NA,caption = "Indicator - Vital Statistics",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="V7") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="V7") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="V7") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="V7") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="V7") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="V7") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
                   ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------
  
### Peer Comparison Over Time
  
```{r}
#LINE
line_V7 = cca_data %>% 
  filter(code=="V7") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.11), 
                     breaks = seq(0, 0.11, 0.02)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_V7, tooltip = c("MSA", "value"))
```

### Peer Comparison - 2023

```{r}
#BAR
bar_V7 = cca_data %>%
  filter(code=="V7") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.11), breaks = seq(0,0.11,0.02))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_V7, tooltip = c("MSA", "value"))
```


# Individual Tax Rate {data-navmenu="Vital Stats"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Top-tier Individual State Tax Rate",icon = NA,caption = "Indicator - Vital Statistics",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="V8") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="V8") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="V8") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="V8") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="V8") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="V8") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
                   ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------
  
### Peer Comparison Over Time
   
```{r}
#LINE
line_V8 = cca_data %>% 
  filter(code=="V8") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.15), 
                     breaks = seq(0, 0.15, 0.025)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_V8, tooltip = c("MSA", "value"))
```

### Peer Comparison - 2023

```{r}
#BAR
bar_V8 = cca_data %>%
  filter(code=="V8") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.15), breaks = seq(0,0.15,0.025))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_V8, tooltip = c("MSA", "value"))
```


# Poverty Rate, White {data-navmenu="Vital Stats"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Poverty Rate of White Residents",icon = NA,caption = "Indicator - Vital Statistics",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="V9") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="V9") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="V9") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Worsening",
              ifelse(box3b<box3a,"Improving","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-down",
                   ifelse(box3 == "Worsening","fa-arrow-up","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="V9") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="V9") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="V9") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
                   ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------
  
### Peer Comparison Over Time
  
```{r}
#LINE
line_V9 = cca_data %>% 
  filter(code=="V9") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.30), 
                     breaks = seq(0, 0.30, 0.05)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_V9, tooltip = c("MSA", "value"))
```

### Peer Comparison - 2023

```{r}
#BAR
bar_V9 = cca_data %>%
  filter(code=="V9") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.30), breaks = seq(0,0.30,0.05))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_V9, tooltip = c("MSA", "value"))
```


# Poverty Rate, BIPOC {data-navmenu="Vital Stats"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Poverty Rate of Residents of Color",icon = NA,caption = "Indicator - Vital Statistics",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="V10") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="V10") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="V10") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Worsening",
              ifelse(box3b<box3a,"Improving","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-down",
                   ifelse(box3 == "Worsening","fa-arrow-up","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="V10") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Lowest"
box4[box4_temp == 2] <- "2nd Lowest"
box4[box4_temp == 3] <- "3rd Lowest"
box4[box4_temp == 4] <- "4th Lowest"
box4[box4_temp == 5] <- "5th Lowest"
box4[box4_temp == 6] <- "6th Lowest"
box4[box4_temp == 7] <- "7th Lowest"
box4[box4_temp == 8] <- "8th Lowest"
box4[box4_temp == 9] <- "9th Lowest"
box4[box4_temp == 10] <- "10th Lowest"
box4[box4_temp == 11] <- "11th Lowest"
box4[box4_temp == 12] <- "12th Lowest"

box4a = cca_data %>%
  filter(code=="V10") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="V10") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-down",
                   ifelse(box4b>box4a,"fa-arrow-up","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------
  
### Peer Comparison Over Time
  
```{r}
#LINE
line_V10 = cca_data %>% 
  filter(code=="V10") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.30), 
                     breaks = seq(0, 0.30, 0.05)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_V10, tooltip = c("MSA", "value"))
```

### Peer Comparison - 2023

```{r}
#BAR
bar_V10 = cca_data %>%
  filter(code=="V10") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.35), breaks = seq(0,0.35,0.05))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_V10, tooltip = c("MSA", "value"))
```


# Population {data-navmenu="Vital Stats"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Population",icon = NA,caption = "Indicator - Vital Statistics",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="V11") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%  
  dplyr::mutate_if(is.numeric, round, 1) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="V11") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="V11") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="V11") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="V11") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="V11") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
              ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```
Row {data-width=350}
-----------------------------------------------------------------------

### Peer Comparison Over Time

```{r}
#LINE
line_V11 = cca_data %>% 
  filter(code=="V11") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 10000000), 
                     breaks = seq(0, 2000000, 10000000)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_V11, tooltip = c("MSA", "value"))

```

### Peer Comparison - 2023

```{r}
#BAR
bar_V11 = cca_data %>%
  filter(code=="V11") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::comma, limits = c(0,10000000), breaks = seq(0,10000000,2000000))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_V11, tooltip = c("MSA", "value"))
```


# Population Growth {data-navmenu="Vital Stats"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Population Growth",icon = NA,caption = "Indicator - Vital Statistics",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="V12") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="V12") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="V12") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="V12") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="V12") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="V12") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-down",
                   ifelse(box4b>box4a,"fa-arrow-up","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------
  
### Peer Comparison Over Time
  
```{r}
#LINE
line_V12 = cca_data %>% 
  filter(code=="V12") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(-0.02, 0.05), 
                     breaks = seq(-0.02, 0.05, 0.01)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_V12, tooltip = c("MSA", "value"))
```

### Peer Comparison - 2023

```{r}
#BAR
bar_V12 = cca_data %>%
  filter(code=="V12") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(-0.02, 0.05), breaks = seq(-0.02, 0.05, 0.01))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_V12, tooltip = c("MSA", "value"))
```


# % Population of Color {data-navmenu="Vital Stats"}

Row {data-width=150}
--------------------------------------
### Indicator
```{r}
valueBox(value = "Population of Color as %",icon = NA,caption = "Indicator - Vital Statistics",color = "lightblue")
```

### Indicator
```{r}
#devise way to code drive 
box2 = cca_data %>%
  filter(code=="V13") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  mutate(value = scales::percent(value, accuracy = 0.1)) %>%
  pull(value)

valueBox(value = box2,icon = NA,caption = "MSP Region, 2023",color = "lightblue")
```

### MSP Trends
```{r}
box3a = cca_data %>%
  filter(code=="V13") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3b = cca_data %>%
  filter(code=="V13") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(value)
box3 = ifelse(box3b>box3a,"Improving",
              ifelse(box3b<box3a,"Worsening","Unchanged"))
box3_icon = ifelse(box3 == "Improving", "fa-arrow-up",
                   ifelse(box3 == "Worsening","fa-arrow-down","ion-code"))

valueBox(value = box3,icon = box3_icon,caption = "MSP trend from 2021", color = "lightblue")
```

### Peer Comparison
```{r}
box4_temp = cca_data %>%
  filter(code=="V13") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4 = "N/A"
box4[box4_temp == 1] <- "1st Highest"
box4[box4_temp == 2] <- "2nd Highest"
box4[box4_temp == 3] <- "3rd Highest"
box4[box4_temp == 4] <- "4th Highest"
box4[box4_temp == 5] <- "5th Highest"
box4[box4_temp == 6] <- "6th Highest"
box4[box4_temp == 7] <- "7th Highest"
box4[box4_temp == 8] <- "8th Highest"
box4[box4_temp == 9] <- "9th Highest"
box4[box4_temp == 10] <- "10th Highest"
box4[box4_temp == 11] <- "11th Highest"
box4[box4_temp == 12] <- "12th Highest"

box4a = cca_data %>%
  filter(code=="V13") %>%
  filter(year == PY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4b = cca_data %>%
  filter(code=="V13") %>%
  filter(year == EY) %>%
  filter(MSA == "MSP") %>%
  pull(rank)
box4_icon = ifelse(box4b<box4a,"fa-arrow-up",
                   ifelse(box4b>box4a,"fa-arrow-down","ion-code"))

valueBox(value = box4, icon = box4_icon,caption = "out of 12 regions", color = "white")
```

Row {data-width=350}
-----------------------------------------------------------------------
  
### Peer Comparison Over Time
  
```{r}
#LINE
line_V13 = cca_data %>% 
  filter(code=="V13") %>%
  na.omit() %>%
  ggplot( aes(x=year, y=value, group=MSA, color = Legend)) +
  geom_line(aes(size=Legend)) + 
  geom_point(size = 1.8) + 
  scale_x_continuous(expand = c(0.04, 0), limits = c(BY, EY), 
                     breaks = seq(2015, 2023, 1)) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0,0.70), 
                     breaks = seq(0,0.70, 0.10)) +
  scale_color_manual(values=c(MSP='seagreen3', 'peer regions'='grey')) +
  scale_size_manual(values = c(MSP=1.2, no=0.8))+
  theme(
    text = element_text(family = "Lato"),
    legend.position = "none"
  )

ggplotly(line_V13, tooltip = c("MSA", "value"))
```

### Peer Comparison - 2023

```{r}
#BAR
bar_V13 = cca_data %>%
  filter(code=="V13") %>%
  filter(year == EY) %>%
  ggplot(aes(x=reorder(MSA, -rank), y=value, group=MSA, fill = Legend)) + 
  geom_bar(stat="identity")  + 
  scale_fill_manual(values=c("seagreen3","grey")) +
  coord_flip() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) +
  scale_y_continuous(labels = scales::percent, limits = c(0,0.70), breaks = seq(0,0.70,0.10))+
  xlab("") +
  ylab("") +
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "grey"),
    panel.grid.minor = element_line(color = "grey"),
    axis.line.x = element_line(color = "grey"),
    plot.title=element_text(size=18, face = 'bold'),
    plot.subtitle=element_text(size=12, face = 'italic'),
    axis.title.y =element_text(size=12, face = 'italic', margin = margin(r = 10)),
    axis.text.x = element_text(size = 10, face = 'bold'),
    axis.text.y = element_text(size = 12, face = 'bold'),
    plot.margin = unit(c(1,1,1,1.5), "cm"),
    plot.caption = element_text(hjust = 0),
    text = element_text(family = "Lato")
  )

ggplotly(bar_V13, tooltip = c("MSA", "value"))
```
